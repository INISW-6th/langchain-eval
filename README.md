# 한국어 역사문서 기반 RAG 실험 시스템

이 프로젝트는 'LangChain + HuggingFace LLM + 한국어 전용 임베딩 모델'을 활용한 'RAG(Retrieval-Augmented Generation)' 기반 질의응답 시스템 실험입니다.
주요 목표는 다양한 모델 조합과 벡터스토어 세팅에 따른 '정확도 및 교육적 유용성' 비교입니다.

## 실험 목적
- 한국어 기반 문서(교과서, 민족대백과 등)를 바탕으로 한 '정확한 역사 서술 생성'
- 다양한 LLM 및 임베딩/벡터 조합에 따라 '응답 품질 변화 분석'
- '리랭커 적용 유무' 및 '벡터스토어 선택'에 따른 결과 비교
- 교육 콘텐츠로 활용 가능한 출력 구성 평가

![](/src/eval-pipeline.png)

## 기본 실험 조건
- 질문: '조선의 건국과정'
- 프롬프트: 고정
- Chunking 방식: 'recursive' 고정
- Fixed Chunk: 사용 안 함 (문장 단위 깨짐 현상 있음)
- Initial Top-K: 20 → Rerank Top-K: 5

## 실험 조건
1. llm, embedding, vector 고정 → reranker만 변경
2. llm, embedding 고정 → vector, reranker 변경
3. llm 고정 → embedding, vector, reranker 변경
4. llm 변경 → 위 1~3번 실험 반복
5. llm 변경 시 런타임 재시작 필요

## llm-as-a-judge(Chat GPT-4o) 평가 기준

**<1차 평가 기준>**

* 평가 항목 및 배점
1. 역사 사실 정확도 (2점)
- 문서에서 확인 가능한 사실만 제시했는가?
- 역사적 사건, 연도, 인물 서술이 문서와 일치하는가?

2. 문서 참조 충실도 (2점)
- 교과서, 지도안, 민족대백과 등 다양한 문서를 균형 있게 인용했는가?

3. 구조적 완성도 (1점)
- 기(起)-승(承)-전(轉)-결 구조가 명확히 드러나는가?

4. 교육적 유용성 (1점)
- 중학생이 이해할 수 있도록 쉬운 문장과 어휘를 사용했는가?

5. 신화성 배제 (1점)
- 과장된 표현, 신비주의, 비사실적 상상 없이 작성되었는가?

** 평가 시 유의사항
1. 반드시 제공된 문서(교과서, 지도안, 대백과)에 기반해 판단하시오.

2. “문서에 없는 표현이 있으면 감점”한다.

3. 평가 중 다음도 체크하시오
- 주관적 문장, 감정적 표현, 신화적 해석 포함 여부
- 기승전결 구조가 문단마다 구분되어 있는지
- 교과서에 사용된 표현 및 문체와 유사한지

4. 중학생 이해 가능성 판단은 다음 기준을 따른다
- 쉬운 어휘 / 짧은 문장 / 설명적 표현 사용 여부
- 교과서에서 사용하는 표현과 일치하거나 유사한 문체 

## 고정 프롬프트
```
당신은 모든 문서에서만 정보를 추출하여 답변해야 합니다.
당신은 모든 문서를 기반으로 역사적 사실만 전달해야하는 역사선생님 입니다.
검색된 모든 문서 내용에 없는 정보는 절대 추측하지 말고 '해당 정보는 제공되지 않았습니다'라고 답하십시오.
주어진 문서에 없는 추측은 '절대 금지'입니다.
답변은 한번만 출력하도록 하십시오.
답변은 완전한 문장으로 답하시오.
반복되는 문장없이 출력하시오.
한 줄에 한 문장이상 넘지 않도록 출력하고 이어서 아랫줄로 넘어가세요.
문서에 복수 해석이 가능한 경우에는 모두 서술하시오.
예: '아마 ~일 것이다' 형태의 표현은 금지.
최대 10문장이내로 답변하세요.
답변의 각 문장은 어떤 문서의 어느 부분에서 왔는지 정확히 출처를 함께 달아줘.
만약 출처가 없으면 그 내용은 빼고, 추론 없이 대답해줘.
모든 문서를 참고하여 '기승전결' 구조로 수업자료를 작성하시오.

조건:
1. '기(起) - 발단', '승(承) - 전개', '전(轉) - 전환', '결(結) - 마무리' 형식으로 구분하여 작성
2. 각 항목은 간결하게 2~3문장
3. 마지막에 '전체 맥락 요약' 항목을 추가
4. 교과서 스타일의 설명체로 작성
```
## 이슈
- 'FronyAI/frony-embed-large-ko-v1' 임베딩 모델 실행 안 됨 (2048차원 → GPU 용량 문제 추정)
- 'Qwen 8B' 모델: 한국어로만 답하라고 프롬프트를 줘도 영어로 응답함
